# üìò –û–±—â–∏–π —Ñ–æ—Ä–º–∞—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã HUB / SERVICE / DRIVER

## 1. üì•üì§ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Ö–æ–¥–∞ –∏ –≤—ã—Ö–æ–¥–∞
–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è –∫–∞–∫ **—Å–∏–≥–Ω–∞–ª—å–Ω—ã–µ —É–∑–ª—ã**, –∏–º–µ—é—â–∏–µ:
- **–≤—Ö–æ–¥** ‚Äî —Å–∏–≥–Ω–∞–ª, –ø–æ–ª—É—á–∞–µ–º—ã–π –∏–∑–≤–Ω–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∞—É–¥–∏–æ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞, —Ç–µ–∫—Å—Ç –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, HTTP-–∑–∞–ø—Ä–æ—Å);
- **–≤—ã—Ö–æ–¥** ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –¥—Ä—É–≥–∏–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, WAV-—Ñ–∞–π–ª, JSON-–æ—Ç–≤–µ—Ç, —É–ø—Ä–∞–≤–ª—è—é—â–∞—è –∫–æ–º–∞–Ω–¥–∞).

üîÅ –ï—Å–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã, –æ–Ω —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –ª–æ–≥–∏—á–µ—Å–∫–∏ –Ω–∞ –¥–≤–µ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã:

### –ü—Ä–∏–º–µ—Ä—ã:
- `drv-mic-usb`:
  - –≤—Ö–æ–¥: –∞–Ω–∞–ª–æ–≥–æ–≤—ã–π –∑–≤—É–∫ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
  - –≤—ã—Ö–æ–¥: WAV-—Ñ–∞–π–ª (–≤ –ø–∞–ø–∫–µ `./data/drv-mic-usb/audio`)

- `svc-tts-piper`:
  - –≤—Ö–æ–¥: JSON —Å —Ç–µ–∫—Å—Ç–æ–º
  - –≤—ã—Ö–æ–¥: –ø—É—Ç—å –∫ WAV-—Ñ–∞–π–ª—É (–≤ `./data/svc-tts/shared-wav`)

- `gw-dev`:
  - –≤—Ö–æ–¥: —Å–∏–≥–Ω–∞–ª—ã –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (–∞—É–¥–∏–æ, –≤–∏–¥–µ–æ, —Ç–µ–∫—Å—Ç)
  - –≤—ã—Ö–æ–¥: –∫–æ–º–∞–Ω–¥—ã –∏–ª–∏ –º–µ–¥–∏–∞ –æ—Ç AI (TTS, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –¥–µ–π—Å—Ç–≤–∏—è)

- `gw-hub`:
  - –≤—Ö–æ–¥: –æ—Ç –≤—Å–µ—Ö —à–ª—é–∑–æ–≤ (–¥–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤)
  - –≤—ã—Ö–æ–¥: –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç AI –≤ –Ω—É–∂–Ω—ã–π —à–ª—é–∑

---

## 2. üåê –ü—Ä–æ—Ç–æ–∫–æ–ª—ã –æ–±–º–µ–Ω–∞ –∏ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

### üì¶ –û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞:
- –ú–µ–¥–∏–∞ (–∞—É–¥–∏–æ/–≤–∏–¥–µ–æ/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è): **–ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∫–∞–∫ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É** –≤ volume
- –î–∞–Ω–Ω—ã–µ: –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ JSON —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (`device_id`, `input_type`, –∏ —Ç.–¥.)

### üîä –ê—É–¥–∏–æ:
- –§–æ—Ä–º–∞—Ç: WAV 16kHz mono
- –•—Ä–∞–Ω–µ–Ω–∏–µ: `./data/<—Å–µ—Ä–≤–∏—Å>/shared-wav/<uuid>.wav`
- –ò—Å—Ç–æ—á–Ω–∏–∫–∏: –º–∏–∫—Ä–æ—Ñ–æ–Ω—ã (drv), AI (TTS), –≤–Ω–µ—à–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (stream)

### üìπ –í–∏–¥–µ–æ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
- –ö–∞–¥—Ä—ã/–≤–∏–¥–µ–æ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∫–∞–∫ `file_path`
- –§–æ—Ä–º–∞—Ç: JPG / PNG (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è), MP4 (–≤–∏–¥–µ–æ)
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:
  - `wav2lip` (–∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–∏—Ü–æ)
  - `sadtalker`, `screen-snapshots`, `camera` (–≤—Ö–æ–¥)

---

## 3. üîó –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö (–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã)

### –û–±—â–∏–π —Ñ–æ—Ä–º–∞—Ç (–æ—Ç –ª—é–±–æ–≥–æ —à–ª—é–∑–∞ –≤ AI –∏–ª–∏ –æ–±—Ä–∞—Ç–Ω–æ):
```json
{
  "device_id": "frai-001",
  "device_type": "frai",        // frai, dev, chat
  "user_id": "user-xyz",         // –µ—Å–ª–∏ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω
  "input_type": "voice",         // "voice", "text", "image", "video"
  "input_data": "path/to/file.wav" // –∏–ª–∏ —Ç–µ–∫—Å—Ç, base64, URL
}
```

### A. ai-engine -> gw-hub
```json
{
  "device_id": "frai-001",
  "response_type": "voice", // –∏–ª–∏ "text", "image", "video", "action"
  "response_data": "path/to/tts.wav"
}
```

### B. gw-hub -> ai-engine
```json
{
  "device_id": "dev-003",
  "device_type": "dev",
  "user_id": null,
  "input_type": "voice",
  "input_data": "path/to/dev-003-1682030912.wav"
}
```

### C. gw-hub -> gw-frai
```json
{
  "device_id": "frai-001",
  "response_type": "video", // –∏–ª–∏ "voice", "text"
  "response_data": "path/to/wav2lip.mp4"
}
```

### D. gw-hub -> gw-chat
```json
{
  "device_id": "chat-007",
  "response_type": "text",
  "response_data": "–ö–æ–Ω–µ—á–Ω–æ, —Å–µ–π—á–∞—Å –≤–∫–ª—é—á—É —Å–≤–µ—Ç –≤ –∫—É—Ö–Ω–µ."
}
```

### E. gw-hub -> gw-dev
```json
{
  "device_id": "dev-003",
  "response_type": "voice",
  "response_data": "path/to/dev-003-reply.wav"
}
```

### F. gw-frai / gw-chat / gw-dev -> gw-hub
```json
{
  "device_id": "frai-001",
  "input_type": "voice",
  "input_data": "path/to/frai-001-input.wav"
}
```

---

## 4. üîä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Ç–æ–∫–æ–≤ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞

### üî∏ –î—Ä–∞–π–≤–µ—Ä (`drv-*`):
- –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç `device_id` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
- –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç `isFrai` (true/false, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É frai)
- ‚ö†Ô∏è `device_id` ‚Äî —ç—Ç–æ –Ω–µ ID –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞, –∫–∞–º–µ—Ä—ã –∏–ª–∏ –¥–∏–Ω–∞–º–∏–∫–∞, –∞ ID **–∏–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º** (–Ω–∞–ø—Ä–∏–º–µ—Ä: –æ–¥–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ `frai` –∏–ª–∏ `dev`), –≤–∫–ª—é—á–∞—é—â–µ–≥–æ —Å—Ä–∞–∑—É –≤—Å–µ 3 —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∏—Ö (–≤–≤–æ–¥, –≤—ã–≤–æ–¥, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)
- —Å–∏–≥–Ω–∞–ª, –ø—Ä–∏—à–µ–¥—à–∏–π –æ—Ç `device_id=1` –¥–æ–ª–∂–µ–Ω –≤—ã–≤–æ–¥–∏—Ç—å—Å—è **–Ω–∞ —Ç–æ –∂–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å `device_id=1`** (–¥–∏–Ω–∞–º–∏–∫/—ç–∫—Ä–∞–Ω)

```json
{
  "device_id": "frai-001",
  "isFrai": true,
  "audio_path": "path/to/stream.wav"
}
```

### üî∏ –°–µ—Ä–≤–∏—Å (`svc-audio-in`):
- —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç, –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç
- –∏—â–µ—Ç hotword ("—ç–π, –¥–æ–º", "—ç–π, —Ñ—Ä—ç–π" –∏ —Ç.–ø.)
- –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ ‚Äî –Ω–∞—á–∏–Ω–∞–µ—Ç –∑–∞–ø–∏—Å—å –¥–æ –º–æ–ª—á–∞–Ω–∏—è (5—Å) –∏–ª–∏ —Ç–∞–π–º-–∞—É—Ç (2 –º–∏–Ω)
- –ø–µ—Ä–µ–¥–∞—ë—Ç `wav` –≤ STT
- –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
```json
{
  "device_id": "frai-001",
  "isFrai": true,
  "input_type": "voice",
  "input_data": "path/to/recorded.wav"
}
```

### üî∏ Gateway (`gw-frai` / `gw-dev`):
- –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∞—É–¥–∏–æ
- –≤—ã–∑—ã–≤–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `user_id`:
  - `gw-frai`: –≥–æ–ª–æ—Å + –ª–∏—Ü–æ
  - `gw-dev`: –≥–æ–ª–æ—Å / –¥—Ä—É–≥–∏–µ —Å–ø–æ—Å–æ–±—ã
- —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ `gw-hub`

---

## üßπ TODO / –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ
- –£—Ç–æ—á–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç `action` (–¥–ª—è –∞–∫—Ç—É–∞—Ç–æ—Ä–æ–≤)
- –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã `image` –∏ `video` –≤ –æ–±–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å `user_id` –∏ –µ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ biometrics (–ø–æ–∑–∂–µ)
- –†–∞–∑–¥–µ–ª–∏—Ç—å `hotword dict` –∏ `silence/VAD thresholds` –ø–æ YAML –∫–æ–Ω—Ñ–∏–≥—É
- –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç AI-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–æ–∫ (–∏–Ω—Ç–æ–Ω–∞—Ü–∏–∏, —Ñ—Ä–∞–∑—ã)

---

–ì–æ—Ç–æ–≤–æ –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ –∫–∞–∫ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç —Å–∏—Å—Ç–µ–º—ã AI Agent.